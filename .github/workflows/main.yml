name: ðŸ† OMNI-OS PRO - Final Production Build

on:
  workflow_dispatch: # Ù„Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ø¨Ø¶ØºØ·Ø© Ø²Ø±

jobs:
  production-release:
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout Code
        uses: actions/checkout@v4

      - name: â˜• Setup Java & Node
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
      - uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: ðŸŒ Build Web Website (Assets)
        run: |
          mkdir -p www
          # Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
          cat > www/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="en">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>OMNI-OS PRO</title>
              <style>
                  body { background: #0f172a; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
                  .card { background: #1e293b; padding: 2rem; border-radius: 1rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); text-align: center; }
                  button { background: #3b82f6; color: white; border: none; padding: 12px 24px; border-radius: 0.5rem; font-weight: bold; cursor: pointer; margin-top: 1rem; }
              </style>
          </head>
          <body>
              <div class="card">
                  <h1>SmartTools Hub</h1>
                  <p>Production Build Ready</p>
                  <button onclick="window.UnityAdsAndroid ? window.UnityAdsAndroid.showInterstitial('Interstitial_Android') : alert('Ads Initializing...')">Show Reward Ad</button>
              </div>
          </body>
          </html>
          EOF

      - name: ðŸ“¦ Initialize Capacitor Project
        run: |
          echo '{"name":"SmartTools-Hub","version":"1.0.0","dependencies":{"@capacitor/android":"^6.0.0","@capacitor/core":"^6.0.0","@capacitor/cli":"^6.0.0"}}' > package.json
          npm install
          npx cap init "SmartTools Hub" "com.SmartTools.Hub.app" --web-dir www
          npx cap add android

      - name: ðŸ’‰ Inject Unity Ads SDK & Native Code
        run: |
          # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙƒØªØ¨Ø© Ù„Ù…Ù„Ù Gradle
          sed -i '/dependencies {/a \    implementation "com.unity3d.ads:unity-ads:4.12.0"' android/app/build.gradle
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø§Ø± Ø§Ù„Ø¨Ù„Ø§Ø¬Ù† Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ø­Ø²Ù…Ø© com.SmartTools.Hub.app
          mkdir -p android/app/src/main/java/com/omni/pro/app/plugins

          # Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø§ÙØ§ Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
          cat > android/app/src/main/java/com/omni/pro/app/plugins/UnityAdsPlugin.java << 'EOF'
          package com.SmartTools.Hub.app.plugins;
          import android.app.Activity;
          import android.webkit.JavascriptInterface;
          import android.webkit.WebView;
          import com.unity3d.ads.*;

          public class UnityAdsPlugin {
              private Activity activity;
              public UnityAdsPlugin(Activity activity) { this.activity = activity; }

              @JavascriptInterface
              public void showInterstitial(String placementId) {
                  activity.runOnUiThread(() -> {
                      UnityAds.load(placementId, new IUnityAdsLoadListener() {
                          @Override public void onUnityAdsAdLoaded(String pId) { UnityAds.show(activity, pId); }
                          @Override public void onUnityAdsFailedToLoad(String pId, UnityAds.UnityAdsLoadError error, String msg) {}
                      });
                  });
              }
          }
          EOF

          # Ø±Ø¨Ø· Ø§Ù„Ø¨Ù„Ø§Ø¬Ù† Ø¨Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ù…ØªØµÙØ­
          cat > android/app/src/main/java/com/omni/pro/app/MainActivity.java << 'EOF'
          package com.omni.pro.app;
          import android.os.Bundle;
          import com.getcapacitor.BridgeActivity;
          import com.omni.pro.app.plugins.UnityAdsPlugin;

          public class MainActivity extends BridgeActivity {
              @Override public void onCreate(Bundle savedInstanceState) {
                  super.onCreate(savedInstanceState);
                  if (getBridge() != null) {
                      getBridge().getWebView().addJavascriptInterface(new UnityAdsPlugin(this), "UnityAdsAndroid");
                  }
              }
          }
          EOF

      - name: ðŸ”¨ Build Release APK
        run: |
          cd android
          chmod +x gradlew
          ./gradlew assembleRelease

      - name: ðŸ” Sign Production APK
        uses: r0adkll/sign-android-release@v1
        id: sign_app
        with:
          releaseDirectory: android/app/build/outputs/apk/release
          signingKeyBase64: ${{ secrets.SIGNING_KEY }}
          alias: ${{ secrets.KEY_ALIAS }}
          keyStorePassword: ${{ secrets.KEY_STORE_PASSWORD }}
          keyPassword: ${{ secrets.KEY_PASSWORD }}
          buildToolsVersion: 34.0.0

      - name: ðŸ“¤ Upload Signed Artifact
        uses: actions/upload-artifact@v4
        with:
          name: OMNI-OS-PRO-Signed-Release
          path: ${{ steps.sign_app.outputs.signedReleaseFile }}
          
